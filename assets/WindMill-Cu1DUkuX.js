import{c as Y,f as x,C as Z,h as ee,u as oe,G as ie,B as V,M as ne,d as te,s as re,i as se,j as ae,k as ue,l as ce,m as fe,o as le,g as me,e as d,p as de,V as _e}from"./VTextField-DkH9YG_7.js";import{P as ve,u as pe}from"./Positions-LbtfsKQk.js";import{f as xe}from"./ObjModel-hjxOKWMn.js";import{d as S,s as E,c as U,o as z,u as c,v as be,r as he,w as g,l as we,a as _,n as Le,p as Te,q as Me}from"./index-DwcBwe4K.js";const s=12;function Pe(){const t=new ve(9);return t.setPosition(0,-s,0,-s),t.setPosition(1,0,0,-s),t.setPosition(2,s,0,-s),t.setPosition(3,-s,0,0),t.setPosition(4,0,0,0),t.setPosition(5,s,0,0),t.setPosition(6,-s,0,s),t.setPosition(7,0,0,s),t.setPosition(8,s,0,s),t}var Ve=`#version 300 es
precision highp float;in vec3 v_normal;in vec4 v_colour;in vec2 v_texcoord;in vec3 v_tangent;in vec3 v_surfaceToLight;in vec3 v_surfaceToView;uniform vec3 u_emissive;uniform vec3 u_ambient;uniform vec3 u_ambientLight;uniform vec3 u_diffuse;uniform vec3 u_specular;uniform float u_opacity;uniform float u_shininess;uniform sampler2D u_diffuseMap;uniform sampler2D u_normalMap;uniform sampler2D u_specularMap;out vec4 outColour;void main(void){vec3 normal=normalize(v_normal);vec3 tangent=normalize(v_tangent);vec3 bitangent=normalize(cross(normal,tangent));mat3 tbn=mat3(tangent,bitangent,normal);normal=texture(u_normalMap,v_texcoord).rgb*2.0-1.0;normal=normalize(tbn*normal);vec3 surfaceToLightDirection=normalize(v_surfaceToLight);vec3 surfaceToViewDirection=normalize(v_surfaceToView);vec3 halfVector=normalize(surfaceToLightDirection+surfaceToViewDirection);float diffuseLight=dot(surfaceToLightDirection,normal)*0.5+0.5;vec4 diffuseMapColour=texture(u_diffuseMap,v_texcoord);vec3 diffuse=u_diffuse*diffuseMapColour.rgb*v_colour.rgb;float specularLight=clamp(dot(normal,halfVector),0.0,1.0);vec4 specularMapColour=texture(u_specularMap,v_texcoord);vec3 specular=u_specular*specularMapColour.rgb;float opacity=u_opacity*diffuseMapColour.a*v_colour.a;outColour=vec4(u_emissive+u_ambient*u_ambientLight+diffuse*diffuseLight+specular*pow(specularLight,u_shininess),opacity);}`,ge=`#version 300 es
in mat4 a_model_position;in vec3 a_vertex;in vec3 a_normal;in vec4 a_colour;in vec2 a_texcoord;in vec3 a_tangent;uniform mat4 u_projection;uniform mat4 u_view;uniform mat4 u_inverseTransposeView;uniform vec3 u_worldLightPosition;uniform vec3 u_cameraPosition;out vec3 v_normal;out vec4 v_colour;out vec2 v_texcoord;out vec3 v_tangent;out vec3 v_surfaceToLight;out vec3 v_surfaceToView;void main(void){gl_Position=u_projection*u_view*a_model_position*vec4(a_vertex,1.0);v_colour=a_colour;v_texcoord=a_texcoord;vec3 surfaceWorldPosition=(u_view*a_model_position*vec4(a_vertex,1.0)).xyz;v_surfaceToLight=u_worldLightPosition-surfaceWorldPosition;v_surfaceToView=u_cameraPosition-surfaceWorldPosition;mat3 normalMat=mat3(u_inverseTransposeView*a_model_position);v_normal=normalize(normalMat*a_normal);v_tangent=normalize(normalMat*a_tangent);}`;const ye=S({__name:"WindmillScene",props:{modelDefinition:{},textureSet:{}},setup(t,{expose:v}){const b=t,{loadingStore:h}=E(),r=Y(Z.LookAt,x(12,10,12),x(0,5,0)),m=x(2.5,-5,-5),w=x(.1,.1,.1),y=ee(4,1,Uint8Array.of(255,255,255,255)),f=[],A=Pe();function R(e,o,{projection:i,view:l,inverseTransposeView:L},T){o.setClearColour(te),o.setEnableBits(e.BLEND,e.DEPTH_TEST),o.bindUniform("u_projection",n=>e.uniformMatrix4fv(n,!1,i)),o.bindUniform("u_view",n=>e.uniformMatrix4fv(n,!1,l)),o.bindUniform("u_inverseTransposeView",n=>e.uniformMatrix4fv(n,!1,L)),o.bindUniform("u_ambientLight",n=>e.uniform3fv(n,w)),o.bindUniform("u_worldLightPosition",n=>e.uniform3fv(n,m)),o.bindUniform("u_cameraPosition",n=>e.uniform3fv(n,r.position));const M=T.map(({buffer:n,ambient:P,diffuse:F,emissive:N,opacity:O,shininess:G,specular:C,diffuseMap:W,normalMap:k,specularMap:K})=>{const{vertexes:q,normals:H,colours:$,texcoords:J,tangents:Q,indexes:D}=n;re(C,1,.8,.6);const u=se(e);u.bindUniform("u_emissive",a=>e.uniform3fv(a,N)),u.bindUniform("u_ambient",a=>e.uniform3fv(a,P)),u.bindUniform("u_diffuse",a=>e.uniform3fv(a,F)),u.bindUniform("u_specular",a=>e.uniform3fv(a,C)),u.bindUniform("u_opacity",a=>e.uniform1f(a,O)),u.bindUniform("u_shininess",a=>e.uniform1f(a,G+25));const X=ae(fe(e,W),ce(e,k),ue(e,K,y));return le(e,o,u,X,e.TRIANGLES,D.length,A.usedCount,pe("a_model_position",A),d("a_vertex",q,3,e.FLOAT),d("a_normal",H,3,e.FLOAT),d("a_colour",$,4,e.FLOAT),d("a_texcoord",J,2,e.FLOAT),d("a_tangent",Q,3,e.FLOAT),me(D))});return de(e,o,e.TRIANGLES,...M)}function B(e,o){o.bind("ArrowDown",()=>r.pedestal(-.1)),o.bind("ArrowUp",()=>r.pedestal(.1)),o.bind("ArrowLeft",()=>r.arc(-.5)),o.bind("ArrowRight",()=>r.arc(.5)),o.bind("KeyL",()=>f.forEach(i=>i.setDrawMode(e.LINES))),o.bind("KeyK",()=>f.forEach(i=>i.setDrawMode(e.TRIANGLES)))}function I(e,o){o.bind(V.Left,i=>r.arc(-i.movement.dx*.25)),o.bind(V.Right,i=>{r.truck(-i.movement.dx*.1),r.pedestal(i.movement.dy*.1)}),o.bindScroll(i=>r.dolly(i*.25)),o.bind(V.Left+ne.Ctrl,({movement:i})=>{m[0]+=i.dx*.2,m[1]+=i.dy*-.2})}function j(e,o){o.bind(i=>{const{movement:l}=i[0];Math.abs(l.dx)>0&&r.arc(-l.dx*.25)})}const p=oe(r,(e,[o],{keyboard:i,mouse:l,touch:L},T)=>{be(()=>b.modelDefinition,M=>{const n=xe(M);f.splice(0,1/0,R(e,o,T,n)).forEach(P=>P.delete())},{immediate:!0}),B(e,i),I(e,l),j(e,L),h.setLoading(!1)},void 0,()=>{f.forEach(({activate:e,draw:o},i)=>{e(i===0),o()})},void 0,()=>{f.splice(0,1/0).forEach(e=>{e.delete()})});return v({fps:p.fps}),(e,o)=>(z(),U(ie,{"fragment-sources":[c(Ve)],"vertex-sources":[c(ge)],onInit:c(p).init,onResize:c(p).resize,onExit:c(p).exit},null,8,["fragment-sources","vertex-sources","onInit","onResize","onExit"]))}}),Re=S({__name:"WindMill",setup(t){const v=he(void 0),{modelsStore:b,texturesStore:h}=E(),{selectModelById:r,model:m}=b,{currentTexture:w}=h;return r("windmill.obj"),(y,f)=>(z(),U(we,{fluid:"",class:"d-flex flex-column pa-0"},{default:g(()=>[_(Me,{class:"flex-grow-0 flex-shrink-0",color:"secondary"},{default:g(()=>[_(Le),_(Te,{class:"mr-3","max-width":"56"},{default:g(()=>[_(_e,{class:"noMouse","hide-details":"",label:"fps","model-value":v.value?.fps,readonly:""},null,8,["model-value"])]),_:1})]),_:1}),_(ye,{ref_key:"windmillScene",ref:v,class:"flex-fill","model-definition":c(m),"texture-set":c(w)},null,8,["model-definition","texture-set"])]),_:1}))}});export{Re as default};
