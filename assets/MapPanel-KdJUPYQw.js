import{l as ze,d as ke,F as Ve,I as ge,s as Ct,H as Qt,n as tt,J as nt,K as Jt,f as ce,L as en,N as Se,O as tn,o as nn,P as on,q as an,Q as ln,p as rn,R as sn,G as un,S as Fe,a as cn,Z as dn,C as fn,u as vn,T as Re,e as mn,h as hn,i as Z,v as pn,w as yn,x as _n,z as bn,A as xn,k as Me,D as Cn,U as Vn,V as gn,B as Be,M as Tn,E as wn,W as Vt}from"./Float32Buffer-Ew42swuu.js";import{ag as qe,ah as Xe,l as L,u as O,i as We,ai as ot,d as gt,b as ee,w as Ge,a as at,_ as Sn,r as Pn,o as Tt,c as wt,z as X,aj as fe,ak as St,U as _e,L as Pt,W as Ye,C as oe,N as ie,al as Ze,a2 as Et,am as Qe,R as kt,Q as z,E as re,f as b,an as It,a0 as Q,ao as En,H as K,a3 as je,a4 as At,F as ae,ap as de,a7 as Lt,O as Ft,aq as Pe,D as kn,P as In,ar as He,ad as Ie,A as Je,as as An,M as Rt,at as Mt,X as Bt,$ as Ln,au as lt,av as Fn,aw as Rn,a5 as Mn,ax as Bn,ay as Dn,az as Un,Z as Dt,aA as On,aB as Nn,aC as zn,aD as Gn,aE as jn,a8 as Hn,aF as Kn,aG as $n,aH as qn,aI as ye,ab as Xn,aJ as Ke,aK as Wn,aL as Yn,aM as it,aN as Zn,a1 as le,aO as rt,I as Ut,aP as st,aQ as Qn,aR as ut,aS as Ot,aT as Jn,aU as De,aV as eo,aW as Nt,aX as to,aY as no,aZ as oo,a_ as ao,S as Te,a$ as lo,b0 as io,b1 as ro,b2 as so,b3 as uo,b4 as co,b5 as ct,b6 as fo,p as vo,e as we,V as mo,h as dt,g as ho,j as po}from"./index-Bx4UKsSY.js";import{N as yo}from"./Normals-D8NgAgJk.js";import{a as _o,n as bo,f as xo,u as ft,b as Co,m as Vo,c as go,V as $e}from"./VTextField-CUr94lGF.js";import{m as To,V as vt}from"./VSlideGroup-RX1ScKJe.js";function*Ue(e,a){for(const n of ze(a))for(const o of ze(e))yield{x:o,y:n,index:n*e+o,isEvenRow:(n&1)===0}}const mt=ke(),ht=ke();class wo extends Ve{constructor(a){super(a,ge.VEC3)}calculateVertexNormal(a){Ct(a,0,0,0);for(const n of ze(this.capacity))Qt(a,a,this.itemAt(n));tt(a,a)}setFace(a,n,o,r){nt(mt,n,o),nt(ht,o,r);const u=this.itemAt(a);Jt(u,mt,ht),tt(u,u)}}class So extends Ve{constructor(a){super(a,ge.VEC3)}getVertex(a){return this.itemAt(a)}setVertex(a,n,o,r){this.setItem(a,n,o,r)}}function Ee(e,a,n=0){const o=a-n;return((e-n)%o+o)%o+n}function pe(e,a){return[e[0],e[1],a[2]]}function Po(e,a){const{width:n,height:o,terrain1For:r,terrain2For:u,vertexFor:c}=e;function i(g,I){const M=Ee(g,n+1);return Ee(I,o+1)*(n+1)+M}const s=(n+1)*(o+1),h=new So(s),y=new yo(s),V=new Int8Array(s),m=new Int8Array(s);for(const{index:g,x:I,y:M}of Ue(n+1,o+1)){const[S,F,G]=c(I,M);h.setVertex(g,S,F,G),V[g]=r(I,M),m[g]=u(I,M)}const d=new wo(6),v=ke();for(const{index:g,x:I,y:M}of Ue(n+1,o+1)){const S=h.getVertex(g),F=[pe(c(I+1,M),h.getVertex(i(I+1,M))),pe(c(I,M+1),h.getVertex(i(I,M+1))),pe(c(I-1,M+1),h.getVertex(i(I-1,M+1))),pe(c(I-1,M),h.getVertex(i(I-1,M))),pe(c(I-1,M-1),h.getVertex(i(I-1,M-1))),pe(c(I,M-1),h.getVertex(i(I,M-1)))];d.setFace(0,S,F[1],F[0]),d.setFace(1,S,F[2],F[1]),d.setFace(2,S,F[3],F[2]),d.setFace(3,S,F[4],F[3]),d.setFace(4,S,F[5],F[4]),d.setFace(5,S,F[0],F[5]),d.calculateVertexNormal(v),y.setNormal(g,v[0],v[1],v[2])}function _(g,I){return h.getVertex(i(g,I))}function f(g,I){return y.getNormal(i(g,I))}function x(g,I){return V[i(g,I)]}function P(g,I){return m[i(g,I)]}function k(){return Ue(n,o)}return{numVertexes:s,getVertex:_,getNormal:f,getTerrain1Type:x,getTerrain2Type:P,coordinates:k}}function Eo(e,a,n,o,r,u,c){return{ambient:e,diffuse:a,emissive:n,opacity:o,opticalDensity:r,shininess:u,specular:c}}const ko=Eo(ce(1,1,1),ce(.8,.8,.8),ce(0,0,0),1,1,225,ce(.5,.5,.5));function*Io(e,a){for(const[n,o]of e.entries())for(const r of o)yield a(n,r)}function*Ao(e,a){for(const[n,o]of e.entries())yield a(n,o)}const Lo=(e,a)=>[a.uid,a],Fo=(e,a)=>{const n=a.length,o=new Ve(n,ge.MAT4),r=new Ve(n,ge.VEC4),u=new Ve(n,ge.FLOAT);return[e,{positions:o,ids:r,selections:u}]};function Ro(e){const a=new Map(Io(e,Lo)),n=new Map(Ao(e,Fo));function o(c){return en(a.get(c),`No model instance found for uid=${c}`)}function r(c){e.forEach((i,s)=>{const h=n.get(s);if(h===void 0)return;const{positions:y,ids:V,selections:m}=h;y.clear(),V.clear(),m.clear();let d=0;for(const v of i){const{activate:_,deactivate:f,isInView:x}=v;x(c)?(_({position:y.itemAtMarkAsUsed(d),id:V.itemAtMarkAsUsed(d),selection:m.itemAtMarkAsUsed(d)}),d++):f()}})}function u(c){a.forEach(i=>{i.setHovered(i.uid===c)})}return{models:e,buffers:n,findInstanceByUid:o,select:r,hover:u}}var xt;const Oe=(xt=window.requestPostAnimationFrame)!=null?xt:function(e){return requestAnimationFrame(a=>{setTimeout(e,0,a)})};async function Mo(e){const a=Se(e,e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0),"Failed to get sync object");return e.flush(),new Promise((n,o)=>{function r(){switch(e.clientWaitSync(a,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:if(u--)Oe(r);else{const c=e.getError();e.deleteSync(a),o(c)}break;case e.TIMEOUT_EXPIRED:Oe(r);break;default:e.deleteSync(a),n(e.NO_ERROR)}}let u=1;Oe(r)})}async function Bo(e,a,n,o,r,u,c){return await Mo(e),e.bindBuffer(a,n),e.getBufferSubData(a,o,r,u,c),e.bindBuffer(a,null),r}async function Do(e,a,n,o,r,u,c,i,s=0){const h=e.createBuffer();e.bindBuffer(e.PIXEL_PACK_BUFFER,h),e.bufferData(e.PIXEL_PACK_BUFFER,i.byteLength,e.STREAM_READ),e.readPixels(a,n,o,r,u,c,s),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),await Bo(e,e.PIXEL_PACK_BUFFER,h,0,i),e.deleteBuffer(h)}function Uo(e){return{readPixels:(a,n,o,r,u,c,i,s)=>Do(e,a,n,o,r,u,c,i,s)}}function Oo(e,a=300,n=150){const o=Se(e,e.createTexture(),"Failed to create texture");e.bindTexture(e.TEXTURE_2D,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const r=Se(e,e.createRenderbuffer(),"Failed to create render buffer");e.bindRenderbuffer(e.RENDERBUFFER,r);const u=Se(e,e.createFramebuffer(),"Failed to create frame buffer");e.bindFramebuffer(e.FRAMEBUFFER,u),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,r),c(a,n);function c(i,s){e.bindTexture(e.TEXTURE_2D,o),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,i,s,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindRenderbuffer(e.RENDERBUFFER,r),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,i,s)}return{frameBuffer:u,setSize:c}}function No(){const e=qe({hovered:0,selected:new Set});let a,n,o=150;const r=new Uint8Array(4);function u(y){a=y,n=Oo(a)}function c(){if(n===void 0)throw"Picking has not been initialised";return n.frameBuffer}function i(y,V){o=V,n==null||n.setSize(y,V)}function s(){e.selected.clear();const y=e.hovered;return y>0&&e.selected.add(y),y}function h(y){const{x:V,y:m}=y;return new Promise(d=>{if(a===void 0)throw"Picking has not been initialised";Uo(a).readPixels(V,o-m,1,1,a.RGBA,a.UNSIGNED_BYTE,r).then(()=>{const v=_o(r);e.hovered=v,d(v)},()=>{e.hovered=0,d(0)})})}return{...Xe(e),init:u,getPickingFrameBuffer:c,setPickingFrameBufferSize:i,setHoveredAsSelection:s,setMousePosition:h}}const zo=(e,a=6)=>(isFinite(e)?e:0).toString(16).padStart(a,"0");function Go(e,a){return{modelName:e,modelParts:a}}const Ce=1.15;function jo(e,a,n){const o=bo(),r=tn(...nn(o).toArray()),u=qe({worldCoord:{...a},hovered:!1,selected:!1,buffers:void 0}),c=L(v=>{const{x:_,y:f,z:x}=u.worldCoord;return v===void 0?ce(_,f,x):Ct(v,_,f,x)}),i=L(()=>u.selected?.2:u.hovered?.1:0),s=ke();function h(v){on(s,O(c),v);const[_,f,x]=s,P=_/-x,k=f/-x;return P>-Ce&&P<Ce&&k>-Ce&&k<Ce+Ce}function y(v){u.buffers=v,an(u.buffers.position,O(c)),ln(u.buffers.id,r),u.buffers.selection[0]=O(i)}function V(){u.buffers=void 0}function m(v){u.hovered!==v&&(u.hovered=v,u.buffers&&(u.buffers.selection[0]=O(i)))}function d(v){u.selected!==v&&(u.selected=v,u.buffers&&(u.buffers.selection[0]=O(i)))}return{...Xe(u),uid:o,modelName:e,meta:n,isInView:h,activate:y,deactivate:V,setHovered:m,setSelected:d}}function Ho(e,a,n){const o=new Map,r=new Set;return a.nodes.filter(u=>!!u.object).reduce((u,c)=>{const{object:i,altitude:s,position:h}=c,{type:y,index:V}=i;if(y===void 0)return u;const m=y==="DECORATIVE"?`${y}_${V}`:y,d=`${m.toLowerCase()}.obj`;if(r.has(d))return u;let v=o.get(d);if(v===void 0){const k=e.get(d);if(k===void 0)return r.add(d),u;const g=xo(k);v=Go(d,g),o.set(d,v)}const[_,f,x]=n.getVertex(h.x,h.y),P=jo(d,{x:_,y:f,z:x},{objectId:m,position:h,altitude:s});return u.has(v)?u.get(v).push(P):u.set(v,[P]),u},new Map)}function Ko(e){const a=new Float32Array(e*3),n=new Float32Array(e*3),o=new Float32Array(e*2),r=new Uint32Array(e);let u=0,c=0,i=0,s=0,h=0;function y(V,m,d){const[v,_,f]=V,[x,P,k]=m,[g,I]=d;a[u++]=v,a[u++]=_,a[u++]=f,n[c++]=x,n[c++]=P,n[c++]=k,o[i++]=g,o[i++]=I,r[s++]=h++}return{vertexes:a,normals:n,texcoords:o,indexes:r,emitVertex:y}}function $o(e){const{height:a,nodes:n,width:o}=e,r=-(o/2),u=-(a/2);function c(y,V){const m=Ee(y,o),d=Ee(V,a);return n[d*o+m]}function i(y,V){const m=c(y,V),{terrain1:d}=m;return ot(d)}function s(y,V){const m=c(y,V),{terrain2:d}=m;return ot(d)}function h(y,V){const d=(V&1)===0?0:.5,{altitude:v}=c(y,V);return[-(y+d+r),V+u,v*.2]}return{width:o,height:a,terrain1For:i,terrain2For:s,vertexFor:h}}function qo(){const{texturesStore:e}=We();return O(e.currentTexture)}function Xo(e,a){const{numVertexes:n,coordinates:o,getNormal:r,getTerrain1Type:u,getTerrain2Type:c,getVertex:i}=e,{getT1TexCoords:s,getT2TexCoords:h}=a,y=Ko(n*6),{emitVertex:V}=y;function m(d,v,_){V(i(d,v),r(d,v),_)}for(const{x:d,y:v,isEvenRow:_}of o()){const f=u(d,v),x=c(d,v),P=u(d+1,v);if(_){const k=s(x);m(d,v,k[0]),m(d,v+1,k[1]),m(d+1,v,k[2]);const g=h(P);m(d+1,v,g[0]),m(d,v+1,g[1]),m(d+1,v+1,g[2])}else{const k=h(f);m(d,v,k[0]),m(d,v+1,k[1]),m(d+1,v+1,k[2]);const g=s(x);m(d,v,g[0]),m(d+1,v+1,g[1]),m(d+1,v,g[2])}}return y}var Wo=`#version 300 es
precision highp float;in vec3 v_normal;in vec2 v_texcoord;in vec3 v_surfaceToLight;uniform vec3 u_emissive;uniform vec3 u_ambient;uniform vec3 u_ambientLight;uniform vec3 u_diffuse;uniform float u_opacity;uniform sampler2D u_texture;out vec4 outColour;void main(void){vec3 normal=normalize(v_normal);vec3 surfaceToLightDirection=normalize(v_surfaceToLight);float diffuseLight=dot(surfaceToLightDirection,normal)*0.5+0.5;vec4 diffuseColour=texture(u_texture,v_texcoord);vec3 diffuse=u_diffuse*diffuseColour.rgb;float opacity=u_opacity*diffuseColour.a;outColour=vec4(u_emissive+u_ambient*u_ambientLight+diffuse*diffuseLight,opacity);}`,Yo=`#version 300 es
in vec3 a_vertex;in vec2 a_texcoord;in vec3 a_normal;uniform mat4 u_projection;uniform mat4 u_view;uniform vec3 u_worldLightPosition;out vec3 v_normal;out vec2 v_texcoord;out vec3 v_surfaceToLight;void main(void){vec4 worldPosition=u_view*vec4(a_vertex,1.0);gl_Position=u_projection*worldPosition;v_normal=a_normal;v_texcoord=a_texcoord;v_surfaceToLight=u_worldLightPosition-worldPosition.xyz;}`,Zo=`#version 300 es
precision highp float;in vec3 v_normal;in vec4 v_colour;in vec2 v_texcoord;in vec3 v_tangent;in vec3 v_surfaceToLight;in vec3 v_surfaceToView;uniform vec3 u_emissive;uniform vec3 u_ambient;uniform vec3 u_ambientLight;uniform vec3 u_diffuse;uniform vec3 u_specular;uniform float u_opacity;uniform float u_shininess;uniform sampler2D u_diffuseMap;uniform sampler2D u_normalMap;uniform sampler2D u_specularMap;out vec4 outColour;void main(void){vec3 normal=normalize(v_normal)*(float(gl_FrontFacing)*2.0-1.0);vec3 tangent=normalize(v_tangent)*(float(gl_FrontFacing)*2.0-1.0);vec3 bitangent=normalize(cross(normal,tangent));mat3 tbn=mat3(tangent,bitangent,normal);normal=texture(u_normalMap,v_texcoord).rgb*2.0-1.0;normal=normalize(tbn*normal);vec3 surfaceToLightDirection=normalize(v_surfaceToLight);vec3 surfaceToViewDirection=normalize(v_surfaceToView);vec3 halfVector=normalize(surfaceToLightDirection+surfaceToViewDirection);float diffuseLight=dot(surfaceToLightDirection,normal)*0.5+0.5;vec4 diffuseMapColour=texture(u_diffuseMap,v_texcoord);vec3 diffuse=u_diffuse*diffuseMapColour.rgb*v_colour.rgb;float specularLight=clamp(dot(normal,halfVector),0.0,1.0);vec4 specularMapColour=texture(u_specularMap,v_texcoord);vec3 specular=u_specular*specularMapColour.rgb;float opacity=u_opacity*diffuseMapColour.a*v_colour.a;outColour=vec4(u_emissive+u_ambient*u_ambientLight+diffuse*diffuseLight+specular*pow(specularLight,u_shininess),opacity);}`,Qo=`#version 300 es
layout(location=0)in mat4 a_model_position;layout(location=4)in vec3 a_vertex;in vec3 a_normal;layout(location=7)in vec4 a_colour;in float a_selection;in vec2 a_texcoord;in vec3 a_tangent;uniform mat4 u_projection;uniform mat4 u_view;uniform mat4 u_world;uniform vec3 u_worldLightPosition;uniform vec3 u_cameraPosition;out vec3 v_normal;out vec4 v_colour;out vec2 v_texcoord;out vec3 v_tangent;out vec3 v_surfaceToLight;out vec3 v_surfaceToView;void main(){vec4 worldPosition=u_view*a_model_position*vec4(a_vertex,1.0);gl_Position=u_projection*worldPosition;v_colour=a_colour+vec4(a_selection,a_selection,a_selection,0.0);v_texcoord=a_texcoord;v_surfaceToLight=u_worldLightPosition-worldPosition.xyz;v_surfaceToView=u_cameraPosition-worldPosition.xyz;mat3 normalMat=mat3(u_world);v_normal=normalize(normalMat*a_normal);v_tangent=normalize(normalMat*a_tangent);}`,Jo=`#version 300 es
precision highp float;flat in vec4 v_colour;out vec4 outColour;void main(){outColour=v_colour;}`,ea=`#version 300 es
layout(location=0)in mat4 a_model_position;layout(location=4)in vec3 a_vertex;layout(location=7)in vec4 a_colour;uniform mat4 u_projection;uniform mat4 u_view;flat out vec4 v_colour;void main(){gl_Position=u_projection*u_view*a_model_position*vec4(a_vertex,1.0);v_colour=a_colour;}`;function pt(e,a){switch(a){case 0:return e.hqCoordinates;case 1:return e.portalCoordinates;case 2:return{x:e.width/2,y:e.height/2}}}const ta=3e5,zt=rn();sn(zt);const yt=ce(128,0,32),_t=ce(.1,.1,.1),na=gt({name:"MapScene",components:{GlPanel:un},props:{mapDefinition:{type:Object,required:!0},models:{type:Object,required:!0},textureSet:{type:Object,required:!0}},setup(e){const a=ee(void 0),{loadingStore:n}=We(),o=qe({projectionMode:Fe.PERSPECTIVE}),r=[Wo,Zo,Jo],u=[Yo,Qo,ea],c=cn(fn.LookAt,void 0,void 0,dn),i=No();let s;const h=[],y=[];let V;const m=Po($o(e.mapDefinition),qo()),d=Ro(Ho(e.models,e.mapDefinition,m));let v=0;const f=1*12;function x(t,l){var A;const p=(A=pt(t,l))!=null?A:pt(t,2),[T,C,w]=m.getVertex(p.x,p.y);c.lookAt(T,C,w),c.moveTo(T,C+f,f),v=0}function P(t){o.projectionMode=t,J.resize()}function k(t,l,{projection:p,view:T}){const{ambient:C,diffuse:w,emissive:A,opacity:E}=ko;l.setClearColour(mn),l.bindUniform("u_projection",U=>t.uniformMatrix4fv(U,!1,p)),l.bindUniform("u_view",U=>t.uniformMatrix4fv(U,!1,T)),l.bindUniform("u_ambientLight",U=>t.uniform3fv(U,_t)),l.bindUniform("u_worldLightPosition",U=>t.uniform3fv(U,yt)),l.bindUniform("u_emissive",U=>t.uniform3fv(U,A)),l.bindUniform("u_ambient",U=>t.uniform3fv(U,C)),l.bindUniform("u_diffuse",U=>t.uniform3fv(U,w)),l.bindUniform("u_opacity",U=>t.uniform1f(U,E));const{vertexes:B,normals:D,texcoords:N,indexes:R}=Xo(m,e.textureSet),ne=hn(t,l,t.TRIANGLES,R.length,Z("a_vertex",B,3,t.FLOAT),Z("a_texcoord",N,2,t.FLOAT),Z("a_normal",D,3,t.FLOAT),Me(R));return Ge(()=>ne.setTexture(O(G))),ne}function g(t,l,{projection:p,view:T}){return l.bindUniform("u_projection",C=>t.uniformMatrix4fv(C,!1,p)),l.bindUniform("u_view",C=>t.uniformMatrix4fv(C,!1,T)),l.bindUniform("u_world",C=>t.uniformMatrix4fv(C,!1,zt)),l.bindUniform("u_cameraPosition",C=>t.uniform3fv(C,c.position)),l.bindUniform("u_ambientLight",C=>t.uniform3fv(C,_t)),l.bindUniform("u_worldLightPosition",C=>t.uniform3fv(C,yt)),Array.from(d.buffers.entries(),([C,w])=>{const{modelParts:A}=C,{positions:E,selections:B}=w,D=A.map(N=>{const{buffer:R,ambient:ne,diffuse:U,emissive:ve,opacity:me,shininess:he,specular:be,diffuseMap:xe,normalMap:Ae,specularMap:Le}=N,{vertexes:$t,normals:qt,colours:Xt,texcoords:Wt,tangents:Yt,indexes:et}=R,ue=wn(t);ue.bindUniform("u_emissive",Y=>t.uniform3fv(Y,ve)),ue.bindUniform("u_ambient",Y=>t.uniform3fv(Y,ne)),ue.bindUniform("u_diffuse",Y=>t.uniform3fv(Y,U)),ue.bindUniform("u_specular",Y=>t.uniform3fv(Y,be)),ue.bindUniform("u_opacity",Y=>t.uniform1f(Y,me)),ue.bindUniform("u_shininess",Y=>t.uniform1f(Y,he+25));const Zt=pn(bn(t,xe),_n(t,Ae),yn(t,Le));return xn(t,l,ue,Zt,t.TRIANGLES,et.length,E.usedCount,ft("a_model_position",E),Z("a_vertex",$t,3,t.FLOAT),Z("a_normal",qt,3,t.FLOAT),Z("a_colour",Xt,4,t.FLOAT),Z("a_selection",B,1,t.FLOAT,1),Z("a_texcoord",Wt,2,t.FLOAT),Z("a_tangent",Yt,3,t.FLOAT),Me(et))});return Cn(t,l,t.TRIANGLES,...D)})}function I(t,l,{projection:p,view:T}){return l.setClearColour(Vn),l.setEnableBits(t.CULL_FACE,t.DEPTH_TEST),l.bindUniform("u_projection",C=>t.uniformMatrix4fv(C,!1,p)),l.bindUniform("u_view",C=>t.uniformMatrix4fv(C,!1,T)),Array.from(d.buffers.entries(),([C,w])=>{const{modelParts:A}=C,{ids:E,positions:B}=w,{buffer:D}=A[0],{indexes:N,vertexes:R}=D;return gn(t,l,t.TRIANGLES,N.length,B.usedCount,ft("a_model_position",B),Z("a_vertex",R,3,t.FLOAT),Z("a_colour",E,4,t.FLOAT,1),Me(N))})}function M(t,l){l.bind("ArrowDown",()=>c.pedestal(-.5)),l.bind("ArrowUp",()=>c.pedestal(.5)),l.bind("ArrowLeft",()=>v+=100),l.bind("ArrowRight",()=>v-=100),l.bind("Home",()=>x(e.mapDefinition,0)),l.bind("End",()=>x(e.mapDefinition,1)),l.bind("Space",()=>v=0),l.bind("KeyC",()=>x(e.mapDefinition,2)),l.bind("KeyO",()=>P(Fe.ORTHOGRAPHIC)),l.bind("KeyP",()=>P(Fe.PERSPECTIVE)),l.bind("KeyL",()=>{s.setDrawMode(t.LINES),h.forEach(p=>p.setDrawMode(t.LINES)),y.forEach(p=>p.setDrawMode(t.LINES))}),l.bind("KeyK",()=>{s.setDrawMode(t.TRIANGLES),h.forEach(p=>p.setDrawMode(t.TRIANGLES)),y.forEach(p=>p.setDrawMode(t.TRIANGLES))})}function S(t,l){let p=0;l.bind(Be.Left,()=>{if(O(i.hovered)!==p){if(O(i.selected).forEach(T=>d.findInstanceByUid(T).setSelected(!1)),p=i.setHoveredAsSelection(),p>0){const T=d.findInstanceByUid(p),{meta:C,setSelected:w}=T;w(!0),at({uid:zo(p),...C})}else at(void 0);Re(d.buffers.values(),h).forEach((T,C)=>{const{selections:w}=T;C.updateBuffer("a_selection",w,w.usedLength)})}}),l.bind(Be.Right,T=>{c.track(-T.movement.dx/10,-T.movement.dy/10)}),l.bind(Be.Left|Tn.Ctrl,T=>{c.tilt(T.movement.dy/10),c.pan(T.movement.dx/10)}),l.bindScroll(T=>c.dolly(T*.25)),l.bindMove(T=>V=T)}function F(t,l){l.bind(p=>{function T(w,A){const{movement:E}=A,{dx:B,dy:D}=E;(Math.abs(B)>0||Math.abs(D)>0)&&w.track(-B/10,-D/10)}function C(w,A,E){const{movement:B,currentPosition:D}=A,{movement:N,currentPosition:R}=E,{dx:ne,dy:U}=B,{x:ve,y:me}=D,{dx:he,dy:be}=N,{x:xe,y:Ae}=R,Le=Math.sign(ve-xe)*(ne+he)+Math.sign(me-Ae)*(U+be);w.dolly(Le/10)}switch(p.length){case 1:T(c,p[0]);break;case 2:C(c,p[0],p[1]);break}})}const G=L(()=>{var t,l;return(l=(t=e.textureSet)==null?void 0:t.image)!=null?l:new Image}),j=(t,[l,p,T],{keyboard:C,mouse:w,touch:A},E)=>{s=k(t,l,E),d.select(E.view),h.splice(0,h.length,...g(t,p,E)),i.init(t),y.splice(0,y.length,...I(t,T,E)),M(t,C),S(t,w),F(t,A),x(e.mapDefinition,0),n.setLoading(!1)},$=(t,l)=>{const{drawingBufferWidth:p,drawingBufferHeight:T}=t;i.setPickingFrameBufferSize(p,T),d.select(l),Re(d.buffers.values(),h,y).forEach((C,w,A)=>{const{positions:E,ids:B,selections:D}=C;w.setInstanceCount(E.usedCount),w.updateBuffer("a_model_position",E,E.usedLength),w.updateBuffer("a_selection",D,D.usedLength),A.setInstanceCount(E.usedCount),A.updateBuffer("a_model_position",E,E.usedLength),A.updateBuffer("a_colour",B,B.usedLength)})},W=()=>{s.activate(),s.draw(),h.filter(l=>O(l.instanceCount)>0).forEach(l=>{l.activate(!1),l.draw()});let t=0;y.filter(l=>O(l.instanceCount)>0).forEach(l=>{l.activate(t++===0,i.getPickingFrameBuffer()),l.draw()}),t>0&&V&&i.setMousePosition(V).then(te)};let H=0;function te(t){var p;if(t===H)return;H=t;const l=t>0?"pointer":void 0;(p=O(a))==null||p.setMouseCursor(l),d.hover(t),Re(d.buffers.values(),h).forEach((T,C)=>{const{selections:w}=T;C.updateBuffer("a_selection",w,w.usedLength)})}const J=vn(c,j,$,W,t=>{v!==0&&c.arc(v*t/ta)},()=>{y.forEach(t=>t.delete()),h.forEach(t=>t.delete()),s.delete()});return{glPanel:a,...Xe(o),fragmentSources:r,vertexSources:u,onGLInit:J.init,onGLResize:J.resize,onGLExit:J.exit,fps:J.fps}}});function oa(e,a,n,o,r,u){const c=Pn("gl-panel");return Tt(),wt(c,{ref:"glPanel","fragment-sources":e.fragmentSources,"vertex-sources":e.vertexSources,"projection-mode":e.projectionMode,onInit:e.onGLInit,onResize:e.onGLResize,onExit:e.onGLExit},null,8,["fragment-sources","vertex-sources","projection-mode","onInit","onResize","onExit"])}const aa=Sn(na,[["render",oa]]),Gt=Symbol.for("vuetify:selection-control-group"),jt=X({color:String,disabled:{type:Boolean,default:null},defaultsTarget:String,error:Boolean,id:String,inline:Boolean,falseIcon:fe,trueIcon:fe,ripple:{type:[Boolean,Object],default:!0},multiple:{type:Boolean,default:null},name:String,readonly:{type:Boolean,default:null},modelValue:null,type:String,valueComparator:{type:Function,default:St},..._e(),...Pt(),...Ye()},"SelectionControlGroup"),la=X({...jt({defaultsTarget:"VSelectionControl"})},"VSelectionControlGroup");oe()({name:"VSelectionControlGroup",props:la(),emits:{"update:modelValue":e=>!0},setup(e,a){let{slots:n}=a;const o=ie(e,"modelValue"),r=Ze(),u=L(()=>e.id||`v-selection-control-group-${r}`),c=L(()=>e.name||u.value),i=new Set;return Et(Gt,{modelValue:o,forceUpdate:()=>{i.forEach(s=>s())},onForceUpdate:s=>{i.add(s),Qe(()=>{i.delete(s)})}}),kt({[e.defaultsTarget]:{color:z(e,"color"),disabled:z(e,"disabled"),density:z(e,"density"),error:z(e,"error"),inline:z(e,"inline"),modelValue:o,multiple:L(()=>!!e.multiple||e.multiple==null&&Array.isArray(o.value)),name:c,falseIcon:z(e,"falseIcon"),trueIcon:z(e,"trueIcon"),readonly:z(e,"readonly"),ripple:z(e,"ripple"),type:z(e,"type"),valueComparator:z(e,"valueComparator")}}),re(()=>{var s;return b("div",{class:["v-selection-control-group",{"v-selection-control-group--inline":e.inline},e.class],style:e.style,role:e.type==="radio"?"radiogroup":void 0},[(s=n.default)==null?void 0:s.call(n)])}),{}}});const Ht=X({label:String,baseColor:String,trueValue:null,falseValue:null,value:null,..._e(),...jt()},"VSelectionControl");function ia(e){const a=Lt(Gt,void 0),{densityClasses:n}=Ft(e),o=ie(e,"modelValue"),r=L(()=>e.trueValue!==void 0?e.trueValue:e.value!==void 0?e.value:!0),u=L(()=>e.falseValue!==void 0?e.falseValue:!1),c=L(()=>!!e.multiple||e.multiple==null&&Array.isArray(o.value)),i=L({get(){const d=a?a.modelValue.value:o.value;return c.value?Pe(d).some(v=>e.valueComparator(v,r.value)):e.valueComparator(d,r.value)},set(d){if(e.readonly)return;const v=d?r.value:u.value;let _=v;c.value&&(_=d?[...Pe(o.value),v]:Pe(o.value).filter(f=>!e.valueComparator(f,r.value))),a?a.modelValue.value=_:o.value=_}}),{textColorClasses:s,textColorStyles:h}=kn(L(()=>{if(!(e.error||e.disabled))return i.value?e.color:e.baseColor})),{backgroundColorClasses:y,backgroundColorStyles:V}=In(L(()=>i.value&&!e.error&&!e.disabled?e.color:e.baseColor)),m=L(()=>i.value?e.trueIcon:e.falseIcon);return{group:a,densityClasses:n,trueValue:r,falseValue:u,model:i,textColorClasses:s,textColorStyles:h,backgroundColorClasses:y,backgroundColorStyles:V,icon:m}}const bt=oe()({name:"VSelectionControl",directives:{Ripple:It},inheritAttrs:!1,props:Ht(),emits:{"update:modelValue":e=>!0},setup(e,a){let{attrs:n,slots:o}=a;const{group:r,densityClasses:u,icon:c,model:i,textColorClasses:s,textColorStyles:h,backgroundColorClasses:y,backgroundColorStyles:V,trueValue:m}=ia(e),d=Ze(),v=Q(!1),_=Q(!1),f=ee(),x=L(()=>e.id||`input-${d}`),P=L(()=>!e.disabled&&!e.readonly);r==null||r.onForceUpdate(()=>{f.value&&(f.value.checked=i.value)});function k(S){P.value&&(v.value=!0,He(S.target,":focus-visible")!==!1&&(_.value=!0))}function g(){v.value=!1,_.value=!1}function I(S){S.stopPropagation()}function M(S){P.value&&(e.readonly&&r&&Ie(()=>r.forceUpdate()),i.value=S.target.checked)}return re(()=>{var $,W,H;const S=o.label?o.label({label:e.label,props:{for:x.value}}):e.label,[F,G]=En(n),j=b("input",K({ref:f,checked:i.value,disabled:!!e.disabled,id:x.value,onBlur:g,onFocus:k,onInput:M,"aria-disabled":!!e.disabled,"aria-label":e.label,type:e.type,value:m.value,name:e.name,"aria-checked":e.type==="checkbox"?i.value:void 0},G),null);return b("div",K({class:["v-selection-control",{"v-selection-control--dirty":i.value,"v-selection-control--disabled":e.disabled,"v-selection-control--error":e.error,"v-selection-control--focused":v.value,"v-selection-control--focus-visible":_.value,"v-selection-control--inline":e.inline},u.value,e.class]},F,{style:e.style}),[b("div",{class:["v-selection-control__wrapper",s.value],style:h.value},[($=o.default)==null?void 0:$.call(o,{backgroundColorClasses:y,backgroundColorStyles:V}),je(b("div",{class:["v-selection-control__input"]},[(H=(W=o.input)==null?void 0:W.call(o,{model:i,textColorClasses:s,textColorStyles:h,backgroundColorClasses:y,backgroundColorStyles:V,inputNode:j,icon:c.value,props:{onFocus:k,onBlur:g,id:x.value}}))!=null?H:b(ae,null,[c.value&&b(de,{key:"icon",icon:c.value},null),j])]),[[At("ripple"),e.ripple&&[!e.disabled&&!e.readonly,null,["center","circle"]]]])]),S&&b(Co,{for:x.value,onClick:I},{default:()=>[S]})])}),{isFocused:v,input:f}}}),ra=X({indeterminate:Boolean,indeterminateIcon:{type:fe,default:"$checkboxIndeterminate"},...Ht({falseIcon:"$checkboxOff",trueIcon:"$checkboxOn"})},"VCheckboxBtn"),sa=oe()({name:"VCheckboxBtn",props:ra(),emits:{"update:modelValue":e=>!0,"update:indeterminate":e=>!0},setup(e,a){let{slots:n}=a;const o=ie(e,"indeterminate"),r=ie(e,"modelValue");function u(s){o.value&&(o.value=!1)}const c=L(()=>o.value?e.indeterminateIcon:e.falseIcon),i=L(()=>o.value?e.indeterminateIcon:e.trueIcon);return re(()=>{const s=Je(bt.filterProps(e),["modelValue"]);return b(bt,K(s,{modelValue:r.value,"onUpdate:modelValue":[h=>r.value=h,u],class:["v-checkbox-btn",e.class],style:e.style,type:"checkbox",falseIcon:c.value,trueIcon:i.value,"aria-checked":o.value?"mixed":void 0}),n)}),{}}}),Kt=Symbol.for("vuetify:v-chip-group"),ua=X({column:Boolean,filter:Boolean,valueComparator:{type:Function,default:St},...To(),..._e(),...An({selectedClass:"v-chip--selected"}),...Rt(),...Ye(),...Mt({variant:"tonal"})},"VChipGroup");oe()({name:"VChipGroup",props:ua(),emits:{"update:modelValue":e=>!0},setup(e,a){let{slots:n}=a;const{themeClasses:o}=Bt(e),{isSelected:r,select:u,next:c,prev:i,selected:s}=Ln(e,Kt);return kt({VChip:{color:z(e,"color"),disabled:z(e,"disabled"),filter:z(e,"filter"),variant:z(e,"variant")}}),re(()=>{const h=vt.filterProps(e);return b(vt,K(h,{class:["v-chip-group",{"v-chip-group--column":e.column},o.value,e.class],style:e.style}),{default:()=>{var y;return[(y=n.default)==null?void 0:y.call(n,{isSelected:r,select:u,next:c,prev:i,selected:s.value})]}})}),{}}});const ca=X({activeClass:String,appendAvatar:String,appendIcon:fe,closable:Boolean,closeIcon:{type:fe,default:"$delete"},closeLabel:{type:String,default:"$vuetify.close"},draggable:Boolean,filter:Boolean,filterIcon:{type:String,default:"$complete"},label:Boolean,link:{type:Boolean,default:void 0},pill:Boolean,prependAvatar:String,prependIcon:fe,ripple:{type:[Boolean,Object],default:!0},text:String,modelValue:{type:Boolean,default:!0},onClick:lt(),onClickOnce:lt(),...Fn(),..._e(),...Pt(),...Rn(),...Mn(),...Bn(),...Dn(),...Un(),...Rt({tag:"span"}),...Ye(),...Mt({variant:"tonal"})},"VChip"),da=oe()({name:"VChip",directives:{Ripple:It},props:ca(),emits:{"click:close":e=>!0,"update:modelValue":e=>!0,"group:selected":e=>!0,click:e=>!0},setup(e,a){let{attrs:n,emit:o,slots:r}=a;const{t:u}=Dt(),{borderClasses:c}=On(e),{colorClasses:i,colorStyles:s,variantClasses:h}=Nn(e),{densityClasses:y}=Ft(e),{elevationClasses:V}=zn(e),{roundedClasses:m}=Gn(e),{sizeClasses:d}=jn(e),{themeClasses:v}=Bt(e),_=ie(e,"modelValue"),f=Hn(e,Kt,!1),x=Kn(e,n),P=L(()=>e.link!==!1&&x.isLink.value),k=L(()=>!e.disabled&&e.link!==!1&&(!!f||e.link||x.isClickable.value)),g=L(()=>({"aria-label":u(e.closeLabel),onClick(S){S.preventDefault(),S.stopPropagation(),_.value=!1,o("click:close",S)}}));function I(S){var F;o("click",S),k.value&&((F=x.navigate)==null||F.call(x,S),f==null||f.toggle())}function M(S){(S.key==="Enter"||S.key===" ")&&(S.preventDefault(),I(S))}return()=>{const S=x.isLink.value?"a":e.tag,F=!!(e.appendIcon||e.appendAvatar),G=!!(F||r.append),j=!!(r.close||e.closable),$=!!(r.filter||e.filter)&&f,W=!!(e.prependIcon||e.prependAvatar),H=!!(W||r.prepend),te=!f||f.isSelected.value;return _.value&&je(b(S,{class:["v-chip",{"v-chip--disabled":e.disabled,"v-chip--label":e.label,"v-chip--link":k.value,"v-chip--filter":$,"v-chip--pill":e.pill},v.value,c.value,te?i.value:void 0,y.value,V.value,m.value,d.value,h.value,f==null?void 0:f.selectedClass.value,e.class],style:[te?s.value:void 0,e.style],disabled:e.disabled||void 0,draggable:e.draggable,href:x.href.value,tabindex:k.value?0:void 0,onClick:I,onKeydown:k.value&&!P.value&&M},{default:()=>{var q,se;return[$n(k.value,"v-chip"),$&&b(qn,{key:"filter"},{default:()=>[je(b("div",{class:"v-chip__filter"},[r.filter?b(ye,{key:"filter-defaults",disabled:!e.filterIcon,defaults:{VIcon:{icon:e.filterIcon}}},r.filter):b(de,{key:"filter-icon",icon:e.filterIcon},null)]),[[Xn,f.isSelected.value]])]}),H&&b("div",{key:"prepend",class:"v-chip__prepend"},[r.prepend?b(ye,{key:"prepend-defaults",disabled:!W,defaults:{VAvatar:{image:e.prependAvatar,start:!0},VIcon:{icon:e.prependIcon,start:!0}}},r.prepend):b(ae,null,[e.prependIcon&&b(de,{key:"prepend-icon",icon:e.prependIcon,start:!0},null),e.prependAvatar&&b(Ke,{key:"prepend-avatar",image:e.prependAvatar,start:!0},null)])]),b("div",{class:"v-chip__content","data-no-activator":""},[(se=(q=r.default)==null?void 0:q.call(r,{isSelected:f==null?void 0:f.isSelected.value,selectedClass:f==null?void 0:f.selectedClass.value,select:f==null?void 0:f.select,toggle:f==null?void 0:f.toggle,value:f==null?void 0:f.value.value,disabled:e.disabled}))!=null?se:e.text]),G&&b("div",{key:"append",class:"v-chip__append"},[r.append?b(ye,{key:"append-defaults",disabled:!F,defaults:{VAvatar:{end:!0,image:e.appendAvatar},VIcon:{end:!0,icon:e.appendIcon}}},r.append):b(ae,null,[e.appendIcon&&b(de,{key:"append-icon",end:!0,icon:e.appendIcon},null),e.appendAvatar&&b(Ke,{key:"append-avatar",end:!0,image:e.appendAvatar},null)])]),j&&b("button",K({key:"close",class:"v-chip__close",type:"button"},g.value),[r.close?b(ye,{key:"close-defaults",defaults:{VIcon:{icon:e.closeIcon,size:"x-small"}}},r.close):b(de,{key:"close-icon",icon:e.closeIcon,size:"x-small"},null)])]}}),[[At("ripple"),k.value&&e.ripple,null]])}}}),fa=X({id:String,...Je(Wn({closeDelay:250,closeOnContentClick:!0,locationStrategy:"connected",openDelay:300,scrim:!1,scrollStrategy:"reposition",transition:{component:Vt}}),["absolute"])},"VMenu"),va=oe()({name:"VMenu",props:fa(),emits:{"update:modelValue":e=>!0},setup(e,a){let{slots:n}=a;const o=ie(e,"modelValue"),{scopeId:r}=Yn(),u=Ze(),c=L(()=>e.id||`v-menu-${u}`),i=ee(),s=Lt(it,null),h=Q(0);Et(it,{register(){++h.value},unregister(){--h.value},closeParents(_){setTimeout(()=>{!h.value&&(_==null||_&&!Zn(_,i.value.contentEl))&&(o.value=!1,s==null||s.closeParents())},40)}});async function y(_){var P,k,g;const f=_.relatedTarget,x=_.target;await Ie(),o.value&&f!==x&&((P=i.value)!=null&&P.contentEl)&&((k=i.value)!=null&&k.globalTop)&&![document,i.value.contentEl].includes(x)&&!i.value.contentEl.contains(x)&&((g=st(i.value.contentEl)[0])==null||g.focus())}le(o,_=>{_?(s==null||s.register(),document.addEventListener("focusin",y,{once:!0})):(s==null||s.unregister(),document.removeEventListener("focusin",y))});function V(_){s==null||s.closeParents(_)}function m(_){var f,x,P;e.disabled||(_.key==="Tab"||_.key==="Enter"&&!e.closeOnContentClick?(_.key==="Enter"&&_.preventDefault(),Qn(st((f=i.value)==null?void 0:f.contentEl,!1),_.shiftKey?"prev":"next",g=>g.tabIndex>=0)||(o.value=!1,(P=(x=i.value)==null?void 0:x.activatorEl)==null||P.focus())):["Enter"," "].includes(_.key)&&e.closeOnContentClick&&(o.value=!1,s==null||s.closeParents()))}function d(_){var x;if(e.disabled)return;const f=(x=i.value)==null?void 0:x.contentEl;f&&o.value?_.key==="ArrowDown"?(_.preventDefault(),ut(f,"next")):_.key==="ArrowUp"&&(_.preventDefault(),ut(f,"prev")):["ArrowDown","ArrowUp"].includes(_.key)&&(o.value=!0,_.preventDefault(),setTimeout(()=>setTimeout(()=>d(_))))}const v=L(()=>K({"aria-haspopup":"menu","aria-expanded":String(o.value),"aria-owns":c.value,onKeydown:d},e.activatorProps));return re(()=>{const _=rt.filterProps(e);return b(rt,K({ref:i,id:c.value,class:["v-menu",e.class],style:e.style},_,{modelValue:o.value,"onUpdate:modelValue":f=>o.value=f,absolute:!0,activatorProps:v.value,"onClick:outside":V,onKeydown:m},r),{activator:n.activator,default:function(){for(var f=arguments.length,x=new Array(f),P=0;P<f;P++)x[P]=arguments[P];return b(ye,{root:"VMenu"},{default:()=>{var k;return[(k=n.default)==null?void 0:k.call(n,...x)]}})}})}),Ut({id:c,ΨopenChildren:h},i)}}),ma=X({renderless:Boolean,..._e()},"VVirtualScrollItem"),ha=oe()({name:"VVirtualScrollItem",inheritAttrs:!1,props:ma(),emits:{"update:height":e=>!0},setup(e,a){let{attrs:n,emit:o,slots:r}=a;const{resizeRef:u,contentRect:c}=Ot(void 0,"border");le(()=>{var i;return(i=c.value)==null?void 0:i.height},i=>{i!=null&&o("update:height",i)}),re(()=>{var i,s;return e.renderless?b(ae,null,[(i=r.default)==null?void 0:i.call(r,{itemRef:u})]):b("div",K({ref:u,class:["v-virtual-scroll__item",e.class],style:e.style},n),[(s=r.default)==null?void 0:s.call(r)])})}}),pa=-1,ya=1,Ne=100,_a=X({itemHeight:{type:[Number,String],default:null},height:[Number,String]},"virtual");function ba(e,a){const n=Jn(),o=Q(0);Ge(()=>{o.value=parseFloat(e.itemHeight||0)});const r=Q(0),u=Q(Math.ceil((parseInt(e.height)||n.height.value)/(o.value||16))||1),c=Q(0),i=Q(0),s=ee(),h=ee();let y=0;const{resizeRef:V,contentRect:m}=Ot();Ge(()=>{V.value=s.value});const d=L(()=>{var l;return s.value===document.documentElement?n.height.value:((l=m.value)==null?void 0:l.height)||parseInt(e.height)||0}),v=L(()=>!!(s.value&&h.value&&d.value&&o.value));let _=Array.from({length:a.value.length}),f=Array.from({length:a.value.length});const x=Q(0);let P=-1;function k(l){return _[l]||o.value}const g=eo(()=>{const l=performance.now();f[0]=0;const p=a.value.length;for(let T=1;T<=p-1;T++)f[T]=(f[T-1]||0)+k(T-1);x.value=Math.max(x.value,performance.now()-l)},x),I=le(v,l=>{l&&(I(),y=h.value.offsetTop,g.immediate(),q(),~P&&Ie(()=>{Nt&&window.requestAnimationFrame(()=>{J(P),P=-1})}))});Qe(()=>{g.clear()});function M(l,p){const T=_[l],C=o.value;o.value=C?Math.min(o.value,p):p,(T!==p||C!==o.value)&&(_[l]=p,g())}function S(l){return l=De(l,0,a.value.length-1),f[l]||0}function F(l){return xa(f,l)}let G=0,j=0,$=0;le(d,(l,p)=>{p&&(q(),l<p&&requestAnimationFrame(()=>{j=0,q()}))});function W(){if(!s.value||!h.value)return;const l=s.value.scrollTop,p=performance.now();p-$>500?(j=Math.sign(l-G),y=h.value.offsetTop):j=l-G,G=l,$=p,q()}function H(){!s.value||!h.value||(j=0,$=0,q())}let te=-1;function q(){cancelAnimationFrame(te),te=requestAnimationFrame(se)}function se(){if(!s.value||!d.value)return;const l=G-y,p=Math.sign(j),T=Math.max(0,l-Ne),C=De(F(T),0,a.value.length),w=l+d.value+Ne,A=De(F(w)+1,C+1,a.value.length);if((p!==pa||C<r.value)&&(p!==ya||A>u.value)){const E=S(r.value)-S(C),B=S(A)-S(u.value);Math.max(E,B)>Ne?(r.value=C,u.value=A):(C<=0&&(r.value=C),A>=a.value.length&&(u.value=A))}c.value=S(r.value),i.value=S(a.value.length)-S(u.value)}function J(l){const p=S(l);!s.value||l&&!p?P=l:s.value.scrollTop=p}const t=L(()=>a.value.slice(r.value,u.value).map((l,p)=>({raw:l,index:p+r.value})));return le(a,()=>{_=Array.from({length:a.value.length}),f=Array.from({length:a.value.length}),g.immediate(),q()},{deep:!0}),{containerRef:s,markerRef:h,computedItems:t,paddingTop:c,paddingBottom:i,scrollToIndex:J,handleScroll:W,handleScrollend:H,handleItemResize:M}}function xa(e,a){let n=e.length-1,o=0,r=0,u=null,c=-1;if(e[n]<a)return n;for(;o<=n;)if(r=o+n>>1,u=e[r],u>a)n=r-1;else if(u<a)c=r,o=r+1;else return u===a?r:o;return c}const Ca=X({items:{type:Array,default:()=>[]},renderless:Boolean,..._a(),..._e(),...to()},"VVirtualScroll"),Va=oe()({name:"VVirtualScroll",props:Ca(),setup(e,a){let{slots:n}=a;const o=no("VVirtualScroll"),{dimensionStyles:r}=oo(e),{containerRef:u,markerRef:c,handleScroll:i,handleScrollend:s,handleItemResize:h,scrollToIndex:y,paddingTop:V,paddingBottom:m,computedItems:d}=ba(e,z(e,"items"));return ao(()=>e.renderless,()=>{function v(){var x,P;const f=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1)?"addEventListener":"removeEventListener";u.value===document.documentElement?(document[f]("scroll",i,{passive:!0}),document[f]("scrollend",s)):((x=u.value)==null||x[f]("scroll",i,{passive:!0}),(P=u.value)==null||P[f]("scrollend",s))}lo(()=>{u.value=io(o.vnode.el,!0),v(!0)}),Qe(v)}),re(()=>{const v=d.value.map(_=>b(ha,{key:_.index,renderless:e.renderless,"onUpdate:height":f=>h(_.index,f)},{default:f=>{var x;return(x=n.default)==null?void 0:x.call(n,{item:_.raw,index:_.index,...f})}}));return e.renderless?b(ae,null,[b("div",{ref:c,class:"v-virtual-scroll__spacer",style:{paddingTop:Te(V.value)}},null),v,b("div",{class:"v-virtual-scroll__spacer",style:{paddingBottom:Te(m.value)}},null)]):b("div",{ref:u,class:["v-virtual-scroll",e.class],onScrollPassive:i,onScrollend:s,style:[r.value,e.style]},[b("div",{ref:c,class:"v-virtual-scroll__container",style:{paddingTop:Te(V.value),paddingBottom:Te(m.value)}},[v])])}),{scrollToIndex:y}}});function ga(e,a){const n=Q(!1);let o;function r(i){cancelAnimationFrame(o),n.value=!0,o=requestAnimationFrame(()=>{o=requestAnimationFrame(()=>{n.value=!1})})}async function u(){await new Promise(i=>requestAnimationFrame(i)),await new Promise(i=>requestAnimationFrame(i)),await new Promise(i=>requestAnimationFrame(i)),await new Promise(i=>{if(n.value){const s=le(n,()=>{s(),i()})}else i()})}async function c(i){var y,V;if(i.key==="Tab"&&((y=a.value)==null||y.focus()),!["PageDown","PageUp","Home","End"].includes(i.key))return;const s=(V=e.value)==null?void 0:V.$el;if(!s)return;(i.key==="Home"||i.key==="End")&&s.scrollTo({top:i.key==="Home"?0:s.scrollHeight,behavior:"smooth"}),await u();const h=s.querySelectorAll(":scope > :not(.v-virtual-scroll__spacer)");if(i.key==="PageDown"||i.key==="Home"){const m=s.getBoundingClientRect().top;for(const d of h)if(d.getBoundingClientRect().top>=m){d.focus();break}}else{const m=s.getBoundingClientRect().bottom;for(const d of[...h].reverse())if(d.getBoundingClientRect().bottom<=m){d.focus();break}}}return{onListScroll:r,onListKeydown:c}}const Ta=X({chips:Boolean,closableChips:Boolean,closeText:{type:String,default:"$vuetify.close"},openText:{type:String,default:"$vuetify.open"},eager:Boolean,hideNoData:Boolean,hideSelected:Boolean,listProps:{type:Object},menu:Boolean,menuIcon:{type:fe,default:"$dropdown"},menuProps:{type:Object},multiple:Boolean,noDataText:{type:String,default:"$vuetify.noDataText"},openOnClear:Boolean,itemColor:String,...ro({itemChildren:!1})},"Select"),wa=X({...Ta(),...Je(Vo({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...so({transition:{component:Vt}})},"VSelect"),Sa=oe()({name:"VSelect",props:wa(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,a){let{slots:n}=a;const{t:o}=Dt(),r=ee(),u=ee(),c=ee(),i=ie(e,"menu"),s=L({get:()=>i.value,set:t=>{var l;i.value&&!t&&((l=u.value)!=null&&l.ΨopenChildren)||(i.value=t)}}),{items:h,transformIn:y,transformOut:V}=uo(e),m=ie(e,"modelValue",[],t=>y(t===null?[null]:Pe(t)),t=>{var p;const l=V(t);return e.multiple?l:(p=l[0])!=null?p:null}),d=L(()=>typeof e.counterValue=="function"?e.counterValue(m.value):typeof e.counterValue=="number"?e.counterValue:m.value.length),v=go(),_=L(()=>m.value.map(t=>t.value)),f=Q(!1),x=L(()=>s.value?e.closeText:e.openText);let P="",k;const g=L(()=>e.hideSelected?h.value.filter(t=>!m.value.some(l=>l===t)):h.value),I=L(()=>e.hideNoData&&!g.value.length||e.readonly||(v==null?void 0:v.isReadonly.value)),M=L(()=>{var t;return{...e.menuProps,activatorProps:{...((t=e.menuProps)==null?void 0:t.activatorProps)||{},"aria-haspopup":"listbox"}}}),S=ee(),{onListScroll:F,onListKeydown:G}=ga(S,r);function j(t){e.openOnClear&&(s.value=!0)}function $(){I.value||(s.value=!s.value)}function W(t){var w,A;if(!t.key||e.readonly||v!=null&&v.isReadonly.value)return;["Enter"," ","ArrowDown","ArrowUp","Home","End"].includes(t.key)&&t.preventDefault(),["Enter","ArrowDown"," "].includes(t.key)&&(s.value=!0),["Escape","Tab"].includes(t.key)&&(s.value=!1),t.key==="Home"?(w=S.value)==null||w.focus("first"):t.key==="End"&&((A=S.value)==null||A.focus("last"));const l=1e3;function p(E){const B=E.key.length===1,D=!E.ctrlKey&&!E.metaKey&&!E.altKey;return B&&D}if(e.multiple||!p(t))return;const T=performance.now();T-k>l&&(P=""),P+=t.key.toLowerCase(),k=T;const C=h.value.find(E=>E.title.toLowerCase().startsWith(P));C!==void 0&&(m.value=[C])}function H(t){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!t.props.disabled)if(e.multiple){const p=m.value.findIndex(C=>e.valueComparator(C.value,t.value)),T=l==null?!~p:l;if(~p){const C=T?[...m.value,t]:[...m.value];C.splice(p,1),m.value=C}else T&&(m.value=[...m.value,t])}else{const p=l!==!1;m.value=p?[t]:[],Ie(()=>{s.value=!1})}}function te(t){var l;(l=S.value)!=null&&l.$el.contains(t.relatedTarget)||(s.value=!1)}function q(){var t;f.value&&((t=r.value)==null||t.focus())}function se(t){f.value=!0}function J(t){if(t==null)m.value=[];else if(He(r.value,":autofill")||He(r.value,":-webkit-autofill")){const l=h.value.find(p=>p.title===t);l&&H(l)}else r.value&&(r.value.value="")}return le(s,()=>{if(!e.hideSelected&&s.value&&m.value.length){const t=g.value.findIndex(l=>m.value.some(p=>e.valueComparator(p.value,l.value)));Nt&&window.requestAnimationFrame(()=>{var l;t>=0&&((l=c.value)==null||l.scrollToIndex(t))})}}),le(()=>e.items,(t,l)=>{s.value||f.value&&!l.length&&t.length&&(s.value=!0)}),re(()=>{const t=!!(e.chips||n.chip),l=!!(!e.hideNoData||g.value.length||n["prepend-item"]||n["append-item"]||n["no-data"]),p=m.value.length>0,T=$e.filterProps(e),C=p||!f.value&&e.label&&!e.persistentPlaceholder?void 0:e.placeholder;return b($e,K({ref:r},T,{modelValue:m.value.map(w=>w.props.value).join(", "),"onUpdate:modelValue":J,focused:f.value,"onUpdate:focused":w=>f.value=w,validationValue:m.externalValue,counterValue:d.value,dirty:p,class:["v-select",{"v-select--active-menu":s.value,"v-select--chips":!!e.chips,[`v-select--${e.multiple?"multiple":"single"}`]:!0,"v-select--selected":m.value.length,"v-select--selection-slot":!!n.selection},e.class],style:e.style,inputmode:"none",placeholder:C,"onClick:clear":j,"onMousedown:control":$,onBlur:te,onKeydown:W,"aria-label":o(x.value),title:o(x.value)}),{...n,default:()=>b(ae,null,[b(va,K({ref:u,modelValue:s.value,"onUpdate:modelValue":w=>s.value=w,activator:"parent",contentClass:"v-select__content",disabled:I.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:q},M.value),{default:()=>{var w;return[l&&b(co,K({ref:S,selected:_.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:A=>A.preventDefault(),onKeydown:G,onFocusin:se,onScrollPassive:F,tabindex:"-1","aria-live":"polite",color:(w=e.itemColor)!=null?w:e.color},e.listProps),{default:()=>{var A,E,B,D;return[(A=n["prepend-item"])==null?void 0:A.call(n),!g.value.length&&!e.hideNoData&&((B=(E=n["no-data"])==null?void 0:E.call(n))!=null?B:b(ct,{title:o(e.noDataText)},null)),b(Va,{ref:c,renderless:!0,items:g.value},{default:N=>{var me,he;let{item:R,index:ne,itemRef:U}=N;const ve=K(R.props,{ref:U,key:ne,onClick:()=>H(R,null)});return(he=(me=n.item)==null?void 0:me.call(n,{item:R,index:ne,props:ve}))!=null?he:b(ct,K(ve,{role:"option"}),{prepend:be=>{let{isSelected:xe}=be;return b(ae,null,[e.multiple&&!e.hideSelected?b(sa,{key:R.value,modelValue:xe,ripple:!1,tabindex:"-1"},null):void 0,R.props.prependAvatar&&b(Ke,{image:R.props.prependAvatar},null),R.props.prependIcon&&b(de,{icon:R.props.prependIcon},null)])}})}}),(D=n["append-item"])==null?void 0:D.call(n)]}})]}}),m.value.map((w,A)=>{function E(R){R.stopPropagation(),R.preventDefault(),H(w,!1)}const B={"onClick:close":E,onKeydown(R){R.key!=="Enter"&&R.key!==" "||(R.preventDefault(),R.stopPropagation(),E(R))},onMousedown(R){R.preventDefault(),R.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},D=t?!!n.chip:!!n.selection,N=D?fo(t?n.chip({item:w,index:A,props:B}):n.selection({item:w,index:A})):void 0;if(!(D&&!N))return b("div",{key:w.value,class:"v-select__selection"},[t?n.chip?b(ye,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:w.title}}},{default:()=>[N]}):b(da,K({key:"chip",closable:e.closableChips,size:"small",text:w.title,disabled:w.props.disabled},B),null):N!=null?N:b("span",{class:"v-select__selection-text"},[w.title,e.multiple&&A<m.value.length-1&&b("span",{class:"v-select__selection-comma"},[vo(",")])])])})]),"append-inner":function(){var B;for(var w=arguments.length,A=new Array(w),E=0;E<w;E++)A[E]=arguments[E];return b(ae,null,[(B=n["append-inner"])==null?void 0:B.call(n,...A),e.menuIcon?b(de,{class:"v-select__menu-icon",icon:e.menuIcon},null):void 0])}})}),Ut({isFocused:f,menu:s,select:H},r)}}),La=gt({__name:"MapPanel",setup(e){const a=ee(void 0),{mapStore:n,modelsStore:o,texturesStore:r}=We(),{map:u}=n,{modelCache:c}=o,{currentTexture:i,selectTextureById:s,textureList:h}=r,y=L(()=>{const{worldType:V}=O(u);return O(h).filter(m=>m.worldType===V)});return(V,m)=>(Tt(),wt(mo,{fluid:"",class:"d-flex flex-column pa-0"},{default:we(()=>[b(po,{class:"flex-grow-0 flex-shrink-0",color:"secondary"},{default:we(()=>[b(dt,{class:"ml-3","max-width":"176"},{default:we(()=>[b(Sa,{"item-value":"id","item-title":"name",label:"Landscape","hide-details":"",items:y.value,"model-value":O(i),"menu-props":{openOnHover:!0},"onUpdate:modelValue":O(s)},null,8,["items","model-value","onUpdate:modelValue"])]),_:1}),b(ho),b(dt,{class:"mr-3","max-width":"56"},{default:we(()=>{var d;return[b($e,{class:"noMouse","hide-details":"",label:"fps","model-value":(d=a.value)==null?void 0:d.fps,readonly:""},null,8,["model-value"])]}),_:1})]),_:1}),b(aa,{ref_key:"mapScene",ref:a,class:"flex-fill","map-definition":O(u),models:O(c).contents,"texture-set":O(i)},null,8,["map-definition","models","texture-set"])]),_:1}))}});export{La as default};
