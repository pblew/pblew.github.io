var ee=Object.defineProperty;var oe=(n,t,i)=>t in n?ee(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i;var T=(n,t,i)=>(oe(n,typeof t!="symbol"?t+"":t,i),i);import{l as ne,o as te,F as ie,I as re,p as se,q as ae,f as v,G as ue,a as ce,Y as fe,C as le,u as de,B as M,M as me,e as _e,s as ve,v as pe,w as xe,x as be,z as he,A as Le,k as we,i as m,D as Te,E as Me}from"./Float32Buffer-Ew42swuu.js";import{r as Ce,n as Se,f as ge,u as Ve,V as Ae}from"./VTextField-CUr94lGF.js";import{C as Ue}from"./Colours-CbczBoye.js";import{u as g,d as y,b as z,w as ye,_ as ze,r as De,o as D,c as P,e as C,V as Pe,i as Ie,f as _,g as Ee,h as Re,j as Ge}from"./index-Bx4UKsSY.js";function Fe(n,t){Ce();const i=new Ue(t.usedCount);for(const c of ne(t.usedCount)){const r=Se(),{r:s,g:f,b:h,a:L}=te(r);i.setColour(c,s,f,h,L)}return{...g(n),positions:t,ids:i}}class Be extends ie{constructor(i){super(i,re.MAT4);T(this,"position");T(this,"selectedIndexes");this.selectedIndexes=new Array(i).fill(!0),this.position=se()}setPosition(i,c,r,s){ae(this.position,v(c,r,s)),this.setItem(i,...this.position)}}function Oe(){const n=new Be(1);return n.setPosition(0,0,0,0),n}var Ne=`#version 300 es
precision highp float;in vec3 v_normal;in vec4 v_colour;in vec2 v_texcoord;in vec3 v_tangent;in vec3 v_surfaceToLight;in vec3 v_surfaceToView;uniform vec3 u_emissive;uniform vec3 u_ambient;uniform vec3 u_ambientLight;uniform vec3 u_diffuse;uniform vec3 u_specular;uniform float u_opacity;uniform float u_shininess;uniform sampler2D u_diffuseMap;uniform sampler2D u_normalMap;uniform sampler2D u_specularMap;out vec4 outColour;void main(void){vec3 normal=normalize(v_normal);vec3 tangent=normalize(v_tangent);vec3 bitangent=normalize(cross(normal,tangent));mat3 tbn=mat3(tangent,bitangent,normal);normal=texture(u_normalMap,v_texcoord).rgb*2.0-1.0;normal=normalize(tbn*normal);vec3 surfaceToLightDirection=normalize(v_surfaceToLight);vec3 surfaceToViewDirection=normalize(v_surfaceToView);vec3 halfVector=normalize(surfaceToLightDirection+surfaceToViewDirection);float diffuseLight=dot(surfaceToLightDirection,normal)*0.5+0.5;vec4 diffuseMapColour=texture(u_diffuseMap,v_texcoord);vec3 diffuse=u_diffuse*diffuseMapColour.rgb*v_colour.rgb;float specularLight=clamp(dot(normal,halfVector),0.0,1.0);vec4 specularMapColour=texture(u_specularMap,v_texcoord);vec3 specular=u_specular*specularMapColour.rgb;float opacity=u_opacity*diffuseMapColour.a*v_colour.a;outColour=vec4(u_emissive+u_ambient*u_ambientLight+diffuse*diffuseLight+specular*pow(specularLight,u_shininess),opacity);}`,$e=`#version 300 es
in mat4 a_model_position;in vec3 a_vertex;in vec3 a_normal;in vec4 a_colour;in vec2 a_texcoord;in vec3 a_tangent;uniform mat4 u_projection;uniform mat4 u_view;uniform mat4 u_inverseTransposeView;uniform vec3 u_worldLightPosition;uniform vec3 u_cameraPosition;out vec3 v_normal;out vec4 v_colour;out vec2 v_texcoord;out vec3 v_tangent;out vec3 v_surfaceToLight;out vec3 v_surfaceToView;void main(void){gl_Position=u_projection*u_view*a_model_position*vec4(a_vertex,1.0);v_colour=a_colour;v_texcoord=a_texcoord;vec3 surfaceWorldPosition=(u_view*a_model_position*vec4(a_vertex,1.0)).xyz;v_surfaceToLight=u_worldLightPosition-surfaceWorldPosition;v_surfaceToView=u_cameraPosition-surfaceWorldPosition;mat3 normalMat=mat3(u_inverseTransposeView*a_model_position);v_normal=normalize(normalMat*a_normal);v_tangent=normalize(normalMat*a_tangent);}`;const S=v(2.5,-5,-5),ke=v(.1,.1,.1),qe=new Uint8Array([255,255,255,255]),je=y({name:"TestbedScene",components:{GlPanel:ue},props:{modelDefinition:{type:Object,required:!0},textureSet:{type:Object,required:!0}},setup(n){const t=z(void 0),i=[Ne],c=[$e],r=ce(le.LookAt,v(12,10,12),v(0,5,0),fe);let s;const f=Oe(),p=de(r,(e,[u],{keyboard:d,mouse:x,touch:I},{projection:E,view:R,inverseTransposeView:G})=>{d.bind("ArrowDown",()=>r.pedestal(-.1)),d.bind("ArrowUp",()=>r.pedestal(.1)),d.bind("ArrowLeft",()=>r.arc(-.5)),d.bind("ArrowRight",()=>r.arc(.5)),d.bind("KeyL",()=>s.setDrawMode(e.LINES)),d.bind("KeyK",()=>s.setDrawMode(e.TRIANGLES)),x.bind(M.Left,o=>r.arc(-o.movement.dx*.25)),x.bind(M.Right,o=>{r.truck(-o.movement.dx*.1),r.pedestal(o.movement.dy*.1)}),x.bindScroll(o=>r.dolly(o*.25)),x.bind(M.Left+me.Ctrl,({movement:o})=>{S[0]+=o.dx*.2,S[1]+=o.dy*-.2}),I.bind(o=>{const{movement:b}=o[0];Math.abs(b.dx)>0&&r.arc(-b.dx*.25)}),u.setClearColour(_e),u.setEnableBits(e.BLEND,e.DEPTH_TEST),u.bindUniform("u_projection",o=>e.uniformMatrix4fv(o,!1,E)),u.bindUniform("u_view",o=>e.uniformMatrix4fv(o,!1,R)),u.bindUniform("u_inverseTransposeView",o=>e.uniformMatrix4fv(o,!1,G)),u.bindUniform("u_ambientLight",o=>e.uniform3fv(o,ke)),u.bindUniform("u_worldLightPosition",o=>e.uniform3fv(o,S)),u.bindUniform("u_cameraPosition",o=>e.uniform3fv(o,r.position)),ye(()=>{const b=ge(n.modelDefinition).map(F=>{const{buffer:B,ambient:O,diffuse:N,emissive:$,opacity:k,shininess:q,specular:V,diffuseMap:j,normalMap:K,specularMap:W}=F,{vertexes:Y,normals:H,colours:J,texcoords:Q,tangents:X,positions:A,indexes:U}=Fe(B,f);ve(V,1,.8,.6);const l=Me(e);l.bindUniform("u_emissive",a=>e.uniform3fv(a,$)),l.bindUniform("u_ambient",a=>e.uniform3fv(a,O)),l.bindUniform("u_diffuse",a=>e.uniform3fv(a,N)),l.bindUniform("u_specular",a=>e.uniform3fv(a,V)),l.bindUniform("u_opacity",a=>e.uniform1f(a,k)),l.bindUniform("u_shininess",a=>e.uniform1f(a,q+25));const Z=pe(he(e,j),be(e,K),xe(e,W,qe));return Le(e,u,l,Z,e.TRIANGLES,U.length,A.usedCount,Ve("a_model_position",A),m("a_vertex",Y,3,e.FLOAT),m("a_normal",H,3,e.FLOAT),m("a_colour",J,4,e.FLOAT),m("a_texcoord",Q,2,e.FLOAT),m("a_tangent",X,3,e.FLOAT),we(U))});s=Te(e,u,e.TRIANGLES,...b)})},()=>{},()=>{s&&(s.activate(),s.draw())},void 0,()=>{s.delete()});return{glPanel:t,fragmentSources:i,vertexSources:c,onGLInit:p.init,onGLResize:p.resize,onGLExit:p.exit,fps:p.fps}}});function Ke(n,t,i,c,r,s){const f=De("gl-panel");return D(),P(f,{ref:"glPanel","fragment-sources":n.fragmentSources,"vertex-sources":n.vertexSources,onInit:n.onGLInit,onResize:n.onGLResize,onExit:n.onGLExit},null,8,["fragment-sources","vertex-sources","onInit","onResize","onExit"])}const We=ze(je,[["render",Ke]]),eo=y({__name:"TestBed",setup(n){const t=z(void 0),{modelsStore:i,texturesStore:c}=Ie(),{selectModelById:r,model:s}=i,{currentTexture:f}=c;return r("windmill.obj"),(h,L)=>(D(),P(Pe,{fluid:"",class:"d-flex flex-column pa-0"},{default:C(()=>[_(Ge,{class:"flex-grow-0 flex-shrink-0",color:"secondary"},{default:C(()=>[_(Ee),_(Re,{class:"mr-3","max-width":"56"},{default:C(()=>{var w;return[_(Ae,{class:"noMouse","hide-details":"",label:"fps","model-value":(w=t.value)==null?void 0:w.fps,readonly:""},null,8,["model-value"])]}),_:1})]),_:1}),_(We,{ref_key:"testbedScene",ref:t,class:"flex-fill","model-definition":g(s),"texture-set":g(f)},null,8,["model-definition","texture-set"])]),_:1}))}});export{eo as default};
